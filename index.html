<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Magic</title>

  <!-- PWA -->
  <meta name="theme-color" content="#000000" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <style>
    :root{
      --bg:#0b0b0b; --card:#151515; --text:#f5f5f5; --muted:#8a8a8a;
      --radius:22px; --shadow:0 10px 30px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color:transparent}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font:16px/1.2 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      display:flex; min-height:100vh; overscroll-behavior:none;
    }
    .app{flex:1; display:flex; flex-direction:column; min-height:100vh}
    .stage{
      flex:1; display:flex; align-items:center; justify-content:center;
      overflow:hidden; position:relative; padding:24px;
    }

    /* cards wrapper (for sliding) */
    .track{
      display:flex; height:100%; width:100%;
      touch-action:pan-y; will-change:transform;
      transition:transform .28s ease;
    }

    /* single card */
    .card{
      flex:0 0 100%; height:100%;
      display:flex; align-items:center; justify-content:center;
      padding:18px;
    }
    .panel{
      width:min(92vw, 540px); height:min(78vh, 720px);
      background:linear-gradient(180deg,#181818,#111);
      border-radius:var(--radius); box-shadow:var(--shadow);
      padding:26px 26px 20px; position:relative;
    }
    /* numbers grid */
    .grid{
      display:grid; grid-template-columns:repeat(4,1fr);
      grid-auto-rows:1fr; gap:14px;
      height:100%; place-items:center;
      font-weight:600; font-size:clamp(18px,4.5vw,28px);
      letter-spacing:.5px;
    }

    /* pill page indicators */
    .dots{display:flex; gap:8px; justify-content:center; padding:16px 0 24px}
    .dot{
      width:10px; height:10px; border-radius:999px;
      background:var(--muted); opacity:.45; transition:opacity .2s, transform .2s;
    }
    .dot.active{opacity:1; transform:scale(1.15); background:#fff}

    /* header (in browser only) */
    .topbar{display:flex; justify-content:center; align-items:center; gap:8px; padding:10px 14px 0}
    .btn{
      border:0; border-radius:999px; padding:10px 14px; font-weight:600;
      background:#ffffff10; color:#fff; backdrop-filter:blur(6px); cursor:pointer;
    }
    .btn:active{transform:scale(.98)}

    @media (display-mode: standalone){
      .topbar{display:none;} /* इंस्टॉल होने पर ऊपर की पट्टी हट जाएगी */
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- ब्राउज़र में एक छोटा Install बटन (Android में मेनू में "Add to Home screen" भी आएगा) -->
    <div class="topbar">
      <button id="installBtn" class="btn" hidden>Install</button>
    </div>

    <div class="stage" id="stage">
      <div class="track" id="track"><!-- JS से कार्ड लगेंगे --></div>
    </div>

    <div class="dots" id="dots"></div>
  </div>

  <script>
    // ------- डेटा: 1..31 को 1,2,4,8,16 मास्क से कार्ड बनाओ -------
    const masks = [1,2,4,8,16];           // कार्ड्स इसी क्रम में स्लाइड होंगे
    const makeCardNumbers = m => Array.from({length:31},(_,i)=>i+1).filter(n => (n & m)===m);

    // ------- UI बनाना -------
    const track = document.getElementById('track');
    const dots  = document.getElementById('dots');
    const cards = masks.map(mask => makeCardNumbers(mask));

    cards.forEach(nums=>{
      const card = document.createElement('section');
      card.className = 'card';
      const panel = document.createElement('div');
      panel.className = 'panel';
      const grid = document.createElement('div');
      grid.className = 'grid';

      // दिखावट साफ रखने के लिए 4x8 ग्रिड; जितने नंबर हों उतने भरेंगे
      nums.forEach(n=>{
        const cell = document.createElement('div');
        cell.textContent = n;
        grid.appendChild(cell);
      });

      panel.appendChild(grid);
      card.appendChild(panel);
      track.appendChild(card);
    });

    // पेज डॉट्स
    masks.forEach((_,i)=>{
      const d=document.createElement('div'); d.className='dot'+(i===0?' active':'');
      dots.appendChild(d);
    });
    const setActiveDot=i=>dots.querySelectorAll('.dot').forEach((d,idx)=>d.classList.toggle('active',idx===i));

    // ------- स्लाइड लॉजिक (left↔right) -------
    let index = 0, startX = 0, curX = 0, dragging = false;
    const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));
    const width = ()=>document.querySelector('.stage').clientWidth;

    const apply = (offset=0)=>{
      track.style.transition = dragging ? 'none' : '';
      track.style.transform = `translateX(${(-index*width()+offset)}px)`;
      setActiveDot(index);
    };
    apply();

    // touch
    track.addEventListener('touchstart',e=>{
      dragging=true; startX = e.touches[0].clientX; curX=startX; apply();
    },{passive:true});
    track.addEventListener('touchmove',e=>{
      curX = e.touches[0].clientX;
      const delta = curX - startX;
      apply(delta);
    },{passive:true});
    const end = ()=>{
      const delta = curX - startX;
      dragging=false;
      if(Math.abs(delta) > width()*0.18){
        index = clamp(index + (delta<0 ? 1 : -1), 0, masks.length-1);
      }
      apply();
    };
    track.addEventListener('touchend', end);
    track.addEventListener('touchcancel', end);

    // mouse (desktop)
    let mDown=false;
    track.addEventListener('mousedown',e=>{mDown=true; dragging=true; startX=e.clientX; curX=startX; apply();});
    window.addEventListener('mousemove',e=>{ if(!mDown)return; curX=e.clientX; apply(curX-startX); });
    window.addEventListener('mouseup',()=>{ if(!mDown)return; mDown=false; end(); });

    // resize
    window.addEventListener('resize', ()=>apply());

    // ------- Install Prompt (कस्टम बटन) -------
    let deferredPrompt=null;
    const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', (e)=>{
      e.preventDefault(); deferredPrompt = e; installBtn.hidden=false;
    });
    installBtn.addEventListener('click', async ()=>{
      installBtn.hidden=true;
      if(deferredPrompt){ deferredPrompt.prompt(); deferredPrompt=null; }
    });

    // ------- Service Worker -------
    if('serviceWorker' in navigator){
      window.addEventListener('load', ()=> navigator.serviceWorker.register('./sw.js'));
    }
  </script>
</body>
</html>
